<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StyleGAN3 Progressive Mixing</title>
    <style>
        /* (ê¸°ì¡´ ìŠ¤íƒ€ì¼ ë™ì¼ â€“ ìƒëµ ê°€ëŠ¥) */
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¨ StyleGAN3 Progressive Mixing</h1>
            <p>ê¸°ë¦°ê³¼ ì‚¬ëŒ ì–¼êµ´ ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•˜ê³  ì ì§„ì  í˜¼í•©ì„ ì²´í—˜í•´ë³´ì„¸ìš”</p>
        </div>

        <!-- ì—…ë¡œë“œ ì„¹ì…˜ -->
        <div class="upload-section">
            <div class="upload-grid">
                <div class="upload-area" id="giraffeUpload" onclick="document.getElementById('giraffeFile').click()">
                    <div class="upload-icon">ğŸ¦’</div>
                    <div class="upload-text">ê¸°ë¦° ì´ë¯¸ì§€ ì—…ë¡œë“œ</div>
                    <div class="upload-hint">.jpg ë˜ëŠ” .png íŒŒì¼</div>
                    <button class="upload-button">íŒŒì¼ ì„ íƒ</button>
                    <div class="uploaded-info" id="giraffeInfo"></div>
                    <input type="file" id="giraffeFile" class="file-input" accept=".jpg,.png" onchange="handleFileUpload(this, 'giraffe')">
                </div>
                <div class="upload-area" id="humanUpload" onclick="document.getElementById('humanFile').click()">
                    <div class="upload-icon">ğŸ‘¤</div>
                    <div class="upload-text">ì‚¬ëŒ ì´ë¯¸ì§€ ì—…ë¡œë“œ</div>
                    <div class="upload-hint">.jpg ë˜ëŠ” .png íŒŒì¼</div>
                    <button class="upload-button">íŒŒì¼ ì„ íƒ</button>
                    <div class="uploaded-info" id="humanInfo"></div>
                    <input type="file" id="humanFile" class="file-input" accept=".jpg,.png" onchange="handleFileUpload(this, 'human')">
                </div>
            </div>
            <button class="start-button" id="startButton" onclick="startMixing()" disabled>ğŸš€ ìŠ¤íƒ€ì¼ ë¯¹ì‹± ì‹œì‘í•˜ê¸°</button>
        </div>

        <!-- í˜¼í•© ì„¹ì…˜ -->
        <div class="mixing-section" id="mixingSection">
            <h2 class="section-title">ì ì§„ì  ìŠ¤íƒ€ì¼ í˜¼í•©</h2>
            <div class="controls-panel">
                <div class="seed-controls">
                    <div class="seed-input">
                        <label>ê¸°ë¦° ì‹œë“œ</label>
                        <input type="number" id="giraffeSeed" value="42">
                    </div>
                    <div class="seed-input">
                        <label>ì‚¬ëŒ ì‹œë“œ</label>
                        <input type="number" id="humanSeed" value="123">
                    </div>
                    <button class="random-button" onclick="randomizeSeeds()">ğŸ² ëœë¤</button>
                </div>
                <div class="slider-container">
                    <div class="slider-label">
                        <span class="slider-title">í˜¼í•© ì •ë„</span>
                        <span class="slider-value" id="mixingValue">0%</span>
                    </div>
                    <input type="range" id="mixingSlider" min="0" max="100" value="0" class="mixing-slider" oninput="updateMixing(this.value)">
                </div>
                <div class="play-controls">
                    <button class="play-button" id="playButton" onclick="toggleAnimation()">â–¶ï¸ ì• ë‹ˆë©”ì´ì…˜ ì¬ìƒ</button>
                    <button class="reset-button" onclick="resetMixing()">ğŸ”„ ì´ˆê¸°í™”</button>
                </div>
            </div>
            <div class="result-display">
                <div class="result-image" id="resultImage">
                    <div class="loading-overlay" id="loadingOverlay"><div class="spinner"></div></div>
                    í˜¼í•©ëœ ì´ë¯¸ì§€ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤
                </div>
                <div class="result-info" id="resultInfo"></div>
                <button class="download-button" onclick="downloadImage()" id="downloadButton" style="display:none">ğŸ’¾ ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ</button>
            </div>
        </div>
    </div>

<script>
let uploadedModels = { giraffe: null, human: null };
let currentMixingLevel = 0;
let isAnimating = false;
let animationInterval = null;

function handleFileUpload(input, modelType) {
    const file = input.files[0];
    if (!file) return;

    const info = document.getElementById(`${modelType}Info`);
    document.getElementById(`${modelType}Upload`).classList.add('uploaded');
    info.style.display = 'block';
    info.innerHTML = `<strong>âœ… ${file.name}</strong><br>í¬ê¸°: ${(file.size / 1024 / 1024).toFixed(2)} MB`;

    uploadedModels[modelType] = file;
    if (uploadedModels.giraffe && uploadedModels.human) {
        document.getElementById('startButton').disabled = false;
    }
}

function startMixing() {
    document.querySelector('.upload-section').style.display = 'none';
    document.getElementById('mixingSection').classList.add('active');
    generateMixedImage(0);
}

function updateMixing(value) {
    currentMixingLevel = parseInt(value);
    document.getElementById('mixingValue').textContent = `${value}%`;
    updateResultInfo(currentMixingLevel);
    generateMixedImage(currentMixingLevel);
}

function updateResultInfo(level) {
    const info = document.getElementById('resultInfo');
    info.textContent = level === 0 ? '100% ê¸°ë¦°' : level === 100 ? '100% ì‚¬ëŒ' : `í˜¼í•© ì •ë„: ${level}%`;
}

function randomizeSeeds() {
    document.getElementById('giraffeSeed').value = Math.floor(Math.random() * 999999);
    document.getElementById('humanSeed').value = Math.floor(Math.random() * 999999);
    generateMixedImage(currentMixingLevel);
}

function generateMixedImage(mixLevel) {
    const overlay = document.getElementById('loadingOverlay');
    overlay.classList.add('active');

    const formData = new FormData();
    formData.append('giraffe', uploadedModels.giraffe);
    formData.append('human', uploadedModels.human);
    formData.append('mixing_level', mixLevel);
    formData.append('giraffe_seed', document.getElementById('giraffeSeed').value);
    formData.append('human_seed', document.getElementById('humanSeed').value);

    fetch('http://localhost:8000/mix', {
        method: 'POST',
        body: formData
    }).then(res => res.blob())
      .then(blob => {
        const url = URL.createObjectURL(blob);
        document.getElementById('resultImage').innerHTML = `<img src="${url}" alt="ê²°ê³¼">`;
        overlay.classList.remove('active');
        document.getElementById('downloadButton').style.display = 'inline-block';
    }).catch(() => {
        overlay.classList.remove('active');
        document.getElementById('resultImage').textContent = "ì´ë¯¸ì§€ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.";
    });
}

function toggleAnimation() {
    const btn = document.getElementById('playButton');
    if (isAnimating) {
        clearInterval(animationInterval);
        btn.innerHTML = 'â–¶ï¸ ì• ë‹ˆë©”ì´ì…˜ ì¬ìƒ';
        isAnimating = false;
    } else {
        isAnimating = true;
        btn.innerHTML = 'â¸ï¸ ì¼ì‹œì •ì§€';
        let dir = 1;
        animationInterval = setInterval(() => {
            currentMixingLevel += dir * 2;
            if (currentMixingLevel >= 100 || currentMixingLevel <= 0) dir *= -1;
            document.getElementById('mixingSlider').value = currentMixingLevel;
            updateMixing(currentMixingLevel);
        }, 200);
    }
}

function resetMixing() {
    if (isAnimating) toggleAnimation();
    currentMixingLevel = 0;
    document.getElementById('mixingSlider').value = 0;
    updateMixing(0);
}

function downloadImage() {
    const img = document.querySelector('#resultImage img');
    if (img) {
        const a = document.createElement('a');
        a.href = img.src;
        a.download = `mix_${currentMixingLevel}.png`;
        a.click();
    }
}
</script>
</body>
</html>
